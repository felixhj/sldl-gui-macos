# SoulseekDownloader

A Python GUI application that provides a graphical user interface for batch downloading music from Soulseek using YouTube playlist URLs.

## Overview

SoulseekDownloader is a macOS Python application built with **PyObjC** (Cocoa) that simplifies the process of downloading music from Soulseek. It takes a YouTube playlist URL, extracts the song information, and uses the [slsk-batchdl](https://github.com/fiso64/slsk-batchdl) (`sldl`) command-line tool to download the corresponding tracks from Soulseek.

After the download process is complete, the application automatically finds the most recent `_index.csv` file generated by `sldl`, processes it to add human-readable state and error descriptions, saves the result to `log.csv`, and deletes the original `_index.csv` file.

## Features

- **YouTube Playlist Integration**: Enter a YouTube playlist URL to automatically extract song information.
- **Soulseek Authentication**: Securely log in with your Soulseek username and password.
- **Custom Download Path**: Specify where you want to save your downloaded music.
- **Real-time Output**: View download progress and status updates in real-time.
- **Automated CSV Processing**: Automatically processes the `_index.csv` file post-download:
  - Converts numeric status codes to human-readable descriptions.
  - Saves the cleaned data to `log.csv`.
  - Deletes the original `_index.csv` file.
- **Settings Persistence**: Automatically saves and restores user preferences (credentials, paths, quality settings).
- **Quality Control**: Set preferred and strict requirements for audio format and bitrate.
- **Modern UI**: Clean, intuitive interface built with native Cocoa and PyObjC.
- **Thread-Safe Operations**: Downloads run in a background thread to keep the GUI responsive.

## System Requirements

- **macOS**: 12.0 (Monterey) or later
- **Architecture**: Intel (x64) or Apple Silicon (arm64)

## Prerequisites

Before using SoulseekDownloader, you need to have the `sldl` command-line tool installed on your system. The application expects `sldl` to be available in your system's PATH.

### Installing sldl

The `sldl` tool is the command-line interface for [slsk-batchdl](https://github.com/fiso64/slsk-batchdl). You can install it as follows:

1.  **Download**: Get the latest release from the [slsk-batchdl releases page](https://github.com/fiso64/slsk-batchdl/releases).
2.  **Extract**: Unzip the downloaded file.
3.  **Install**: Make the `sldl` binary executable and move it to a directory in your system's PATH, such as `/usr/local/bin/`.
    ```bash
    chmod +x sldl
    sudo mv sldl /usr/local/bin/
    ```

## Installation

To install SoulseekDownloader on your macOS computer, open the Terminal application and run the following command. It will automatically detect your architecture and install the correct version of the application.

```bash
bash <(curl -sL https://raw.githubusercontent.com/felixhj/sk/pyobjc-implementation/install.sh)
```

The application will be installed in `~/Applications/SoulseekDownloader`.

### Build Variants

The application is built for different macOS versions to ensure compatibility:

- **Monterey (macOS 12)**: For users on macOS 12.0 or later
- **Ventura (macOS 13)**: For users on macOS 13.0 or later
- **Sonoma (macOS 14)**: For users on macOS 14.0 or later

The installer automatically selects the appropriate version for your system.

> **Note**: Monterey builds are created locally since GitHub Actions no longer supports macOS 12 runners. See [BUILD_MONTEREY.md](BUILD_MONTEREY.md) for details on building Monterey versions locally.

### Running the Application

After the installation is complete, you can find the application in the folder mentioned above. You can run it in two ways:

1.  **Finder**: Navigate to your Home folder, then to the `Applications` folder, then to `SoulseekDownloader`, and double-click on `SoulseekDownloader.app`.
2.  **Terminal**:
    ```bash
    open ~/Applications/SoulseekDownloader/SoulseekDownloader.app
    ```

## Usage

1.  **Launch the App**: Run the application using one of the methods above.
2.  **Enter Playlist URL**: Paste the URL of a public or unlisted YouTube playlist.
3.  **Provide Credentials**: Enter your Soulseek username and password. You can choose to have the password remembered for future sessions (stored unencrypted in a local settings file).
4.  **Set Download Path**: Select a directory for your downloads. If left empty, files will be saved in the default location used by `sldl`.
5.  **Configure Audio Quality**:
    - **Preferred**: `sldl` will prioritize files matching these criteria but will accept other files if no match is found.
    - **Strict**: `sldl` will only download files that meet these exact criteria.
6.  **Start Download**: Click the "Start Download" button.
7.  **Monitor Progress**: Track the download status in the main window.
8.  **Check the Log**: Once complete, a `log.csv` file will be created in the download directory with detailed results. The original `_index.csv` is removed automatically.

### Using the CSV Processor Standalone

The CSV processor script can be run independently to process `_index.csv` files from `sldl`. It renames the output to `log.csv` and deletes the original file.

```bash
# Process a single CSV file
python3 csv_processor.py /path/to/_index.csv

# The script will create log.csv in the same directory and delete _index.csv
```

## Settings Persistence

The application saves your settings to `~/.soulseek_downloader_settings.json`. The following are stored:

- Soulseek username and password (password is only saved if "Remember Password" is checked).
- Download path.
- Audio quality preferences.

**Security Note**: The password is saved in plain text. Only use the "Remember Password" feature on a secure, personal computer.

## Project Structure

```
SoulseekDownloader/
├── soulseek_downloader.py    # Main PyObjC GUI application
├── csv_processor.py          # Standalone script to process _index.csv into log.csv
├── run_soulseek_downloader.sh # Launcher script
├── requirements.txt          # Python dependencies
└── README.md                 # This documentation file
```

### Key Components

- **`soulseek_downloader.py`**: The core application logic, GUI, and download management.
- **`csv_processor.py`**: A utility script that runs after downloads to clean up the CSV log file. It converts numeric codes to readable text, renames the file to `log.csv`, and removes the original.
- **`run_soulseek_downloader.sh`**: A simple shell script to launch the application.

## Technical Details

The application operates as follows:

1.  It gathers user input from the GUI.
2.  It constructs and executes a command for the `sldl` tool in a background thread.
3.  It captures and displays the real-time output from `sldl` in the GUI.
4.  After the `sldl` process finishes, it locates the most recent `_index.csv` in the download directory.
5.  It runs `csv_processor.py` to process this file, which creates `log.csv` and deletes the source `_index.csv`.

### CSV Processing

The `sldl` tool generates an `_index.csv` file with numeric codes for download status. `csv_processor.py` adds two new columns, `state_description` and `failure_description`, with human-readable text.

**State Codes:**

- **0**: `Initial`
- **1**: `Downloaded`
- **2**: `Failed`
- **3**: `AlreadyExists`
- **4**: `NotFoundLastTime`

**Failure Reason Codes:**

- **0**: `None`
- **1**: `InvalidSearchString`
- **2**: `OutOfDownloadRetries`
- **3**: `NoSuitableFileFound`
- **4**: `AllDownloadsFailed`
- **5**: `Other`

The final `log.csv` will contain these descriptive columns, providing a clear summary of the download session.

## Troubleshooting

### "sldl command not found" Error

If you get this error when trying to run SoulseekDownloader:

1. **Check if sldl is installed:**

   ```bash
   ls -la /usr/local/bin/sldl
   ```

2. **If not installed, install manually:**

   ```bash
   # For Apple Silicon (M1/M2) Macs:
   curl -L -o sldl.zip "https://github.com/fiso64/slsk-batchdl/releases/latest/download/sldl_osx-arm64.zip"

   # For Intel Macs:
   curl -L -o sldl.zip "https://github.com/fiso64/slsk-batchdl/releases/latest/download/sldl_osx-x64.zip"

   unzip sldl.zip
   chmod +x sldl
   sudo mv sldl /usr/local/bin/
   ```

3. **Add to PATH if needed:**

   ```bash
   echo 'export PATH="/usr/local/bin:$PATH"' >> ~/.zshrc
   source ~/.zshrc
   ```

4. **Verify installation:**
   ```bash
   sldl --version
   ```

### Other Issues

- **Authentication Failures**: Double-check your Soulseek credentials.
- **CSV Processing Fails**: Ensure the download directory is writable, as the script needs to create `log.csv` and delete the original `_index.csv`.

## Requirements

- **Python**: 3.9+
- **OS**: macOS
- **Dependencies**: `pyobjc-framework-Cocoa`
- **`sldl`**: Must be installed and available in the system PATH.

## License

This project is open source. See the LICENSE file for details.

## Disclaimer

This software is for personal and educational use only. Respect copyright laws and the terms of service of Soulseek and YouTube.

## Acknowledgments

- This project is a GUI wrapper for the powerful [slsk-batchdl](https://github.com/fiso64/slsk-batchdl) by [fiso64](https://github.com/fiso64).
- Built with Python and PyObjC.
