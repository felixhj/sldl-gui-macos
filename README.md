# sldl-gui for macOS

A Python GUI application that provides a graphical user interface for batch downloading music from Soulseek using YouTube playlist URLs.

## Overview

sldl-gui for macOS is a Python application built with **PyObjC** (Cocoa) that simplifies the process of downloading music from Soulseek. It takes a YouTube playlist URL, extracts the song information, and uses the [slsk-batchdl](https://github.com/fiso64/slsk-batchdl) (`sldl`) command-line tool to download the corresponding tracks from Soulseek.

After the download process is complete, the application automatically finds the most recent `_index.csv` file generated by `sldl`, processes it to add human-readable state and error descriptions, saves the result to `log.csv`, and deletes the original `_index.csv` file.

## Features

- **YouTube Playlist Integration**: Enter a YouTube playlist URL to automatically extract song information.
- **Soulseek Authentication**: Securely log in with your Soulseek username and password.
- **Custom Download Path**: Specify where you want to save your downloaded music.
- **Listen Port Configuration**: Set a custom listening port to avoid conflicts with other Soulseek clients.
- **Real-time Progress Tracking**: View download progress with accurate step counting and status updates.
- **Automated CSV Processing**: Automatically processes the `_index.csv` file post-download:
  - Converts numeric status codes to human-readable descriptions.
  - Saves the cleaned data to `log.csv`.
  - Deletes the original `_index.csv` file.
- **Settings Persistence**: Automatically saves and restores user preferences (credentials, paths, quality settings, listen port).
- **Quality Control**: Set preferred and strict requirements for audio format and bitrate.
- **Modern UI**: Clean, intuitive interface built with native Cocoa and PyObjC.
- **Thread-Safe Operations**: Downloads run in a background thread to keep the GUI responsive.
- **Self-Contained**: Includes the `sldl` dependency bundled with the application.

## System Requirements

- **macOS**: 12.0 (Monterey) or later
- **Architecture**: Intel (x64) or Apple Silicon (arm64)

## Prerequisites

sldl-gui for macOS now includes the `sldl` command-line tool bundled with the application, so no separate installation is required. The application automatically downloads and bundles the latest version of `sldl` during the build process.

## Installation

To install sldl-gui for macOS on your macOS computer, open the Terminal application and run the following command. It will automatically detect your architecture and install the correct version of the application.

```bash
bash <(curl -sL https://raw.githubusercontent.com/felixhj/sldl-gui-macos/main/install.sh)
```

The application will be installed in `~/Applications/sldl-gui`.

The installer automatically detects your system architecture and macOS version, then downloads and installs the appropriate build. Since `sldl` is now bundled with the application, no additional dependencies need to be installed.

### Build Variants

The application is built for different macOS versions to ensure compatibility:

- **Monterey (macOS 12)**: For users on macOS 12.0 or later
- **Ventura (macOS 13)**: For users on macOS 13.0 or later
- **Sonoma (macOS 14)**: For users on macOS 14.0 or later

The installer automatically selects the appropriate version for your system.

> **Note**: Monterey builds are created locally since GitHub Actions no longer supports macOS 12 runners. See [BUILD_MONTEREY.md](BUILD_MONTEREY.md) for details on building Monterey versions locally.

### Running the Application

After the installation is complete, you can find the application in the folder mentioned above. You can run it in two ways:

1.  **Finder**: Navigate to your Home folder, then to the `Applications` folder, then to `sldl-gui`, and double-click on `sldl-gui.app`.
2.  **Terminal**:
    ```bash
    open ~/Applications/sldl-gui/sldl-gui.app
    ```

### Uninstalling the Application

If you need to remove sldl-gui from your system, you can use the included uninstall script:

1.  **From DMG**: Double-click `uninstall.command` in the DMG file.
2.  **From Terminal**: Run the uninstall script directly:
    ```bash
    ~/Applications/sldl-gui/uninstall.command
    ```

The uninstall script will:

- Remove the sldl-gui application from your system
- Delete all settings and preferences
- Remove any log files created by the application
- Clean up application cache and saved states
- Optionally restart the Dock to refresh any remaining references

## Usage

1.  **Launch the App**: Run the application using one of the methods above.
2.  **Enter Playlist URL**: Paste the URL of a public or unlisted YouTube playlist.
3.  **Provide Credentials**: Enter your Soulseek username and password. You can choose to have the password remembered for future sessions (stored unencrypted in a local settings file).
4.  **Set Listen Port (Optional)**: If you experience port conflicts with other Soulseek clients, specify a custom listening port. Leave empty to use the default (49998).
5.  **Set Download Path**: Select a directory for your downloads. If left empty, files will be saved in the default location used by `sldl`.
6.  **Configure Audio Quality**:
    - **Preferred**: `sldl` will prioritize files matching these criteria but will accept other files if no match is found.
    - **Strict**: `sldl` will only download files that meet these exact criteria.
7.  **Start Download**: Click the "Start Download" button.
8.  **Monitor Progress**: Track the download status with accurate step counting in the main window.
9.  **Check the Log**: Once complete, a `log.csv` file will be created in the download directory with detailed results. The original `_index.csv` is removed automatically.

### Listen Port Configuration

If you encounter port conflicts (e.g., "Failed to start listening on 0.0.0.0:49998"), you can specify a custom listening port:

- **Default Port**: 49998 (used if no custom port is specified)
- **Recommended Range**: 1024-65535 (avoid ports already in use by other applications)
- **Common Alternatives**: 2234-2242 (traditional Soulseek range), 50000+ (high range to avoid conflicts)

The application will remember your preferred port for future sessions.

### Using the CSV Processor Standalone

The CSV processor functionality is now integrated into the main application, but you can still run it independently if needed:

```bash
# Process a single CSV file
python3 csv_processor.py /path/to/_index.csv

# The script will create log.csv in the same directory and delete _index.csv
```

## Settings Persistence

The application saves your settings to `~/.soulseek_downloader_settings.json`. The following are stored:

- Soulseek username and password (password is only saved if "Remember Password" is checked).
- Download path.
- Listen port preference.
- Audio quality preferences.

**Security Note**: The password is saved in plain text. Only use the "Remember Password" feature on a secure, personal computer.

## Project Structure

```
sldl-gui-macos/
├── sldl-gui-macos.py    # Main PyObjC GUI application
├── csv_processor.py          # CSV processing module (integrated)
├── build_monterey.sh         # Build script for Monterey
├── uninstall.command         # Uninstall script for users
├── requirements.txt          # Python dependencies
├── entitlements.plist        # macOS entitlements for signing
├── icon.icns                 # Application icon
└── README.md                 # This documentation file
```

### Key Components

- **`sldl-gui-macos.py`**: The core application logic, GUI, and download management.
- **`csv_processor.py`**: A module that processes CSV log files to add human-readable descriptions.
- **`build_monterey.sh`**: Automated build script that downloads dependencies and creates the application bundle.

## Technical Details

The application operates as follows:

1.  It gathers user input from the GUI.
2.  It constructs and executes a command for the bundled `sldl` tool in a background thread.
3.  It captures and displays the real-time output from `sldl` in the GUI with accurate progress tracking.
4.  After the `sldl` process finishes, it locates the most recent `_index.csv` in the download directory.
5.  It processes this file using the integrated CSV processor, which creates `log.csv` and deletes the source `_index.csv`.

### CSV Processing

The `sldl` tool generates an `_index.csv` file with numeric codes for download status. The integrated CSV processor adds two new columns, `state_description` and `failure_description`, with human-readable text.

**State Codes:**

- **0**: `Initial`
- **1**: `Downloaded`
- **2**: `Failed`
- **3**: `AlreadyExists`
- **4**: `NotFoundLastTime`

**Failure Reason Codes:**

- **0**: `None`
- **1**: `InvalidSearchString`
- **2**: `OutOfDownloadRetries`
- **3**: `NoSuitableFileFound`
- **4**: `AllDownloadsFailed`
- **5**: `Other`

The final `log.csv` will contain these descriptive columns, providing a clear summary of the download session.

## Troubleshooting

### Port Conflicts

If you encounter "Failed to start listening" errors:

1. **Try a different port**: Use the "Listen Port" field to specify an alternative port (e.g., 2234, 50000, 60000).
2. **Check for other Soulseek clients**: Ensure no other Soulseek applications are running.
3. **Restart the application**: Sometimes a restart can resolve port conflicts.

### Authentication Failures

- **Double-check credentials**: Verify your Soulseek username and password.
- **Check Soulseek status**: Ensure the Soulseek network is accessible.

### Other Issues

- **CSV Processing Fails**: Ensure the download directory is writable, as the application needs to create `log.csv` and delete the original `_index.csv`.
- **Application won't start**: Check that you're running macOS 12.0 or later.

## Requirements

- **Python**: 3.9+
- **OS**: macOS 12.0 (Monterey) or later
- **Dependencies**: `pyobjc-framework-Cocoa` (automatically handled by build script)
- **`sldl`**: Automatically bundled with the application

## License

This project is open source. See the LICENSE file for details.

## Disclaimer

This software is for personal and educational use only. Respect copyright laws and the terms of service of Soulseek and YouTube.

## Acknowledgments

- This project is a GUI wrapper for the powerful [slsk-batchdl](https://github.com/fiso64/slsk-batchdl) by [fiso64](https://github.com/fiso64).
- Built with Python and PyObjC.
