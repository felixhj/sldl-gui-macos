# sldl-gui for macOS

A Python GUI application that provides a graphical user interface for batch downloading music from Soulseek using multiple input sources including YouTube playlists, Spotify playlists, wishlist files, and CSV files.

## Acknowledgments

This project is a GUI wrapper for the powerful [slsk-batchdl](https://github.com/fiso64/slsk-batchdl) (`sldl`) command-line tool by [fiso64](https://github.com/fiso64).

**Built with:**

- Python and PyObjC (Cocoa bindings)
- Cursor AI for GUI development

**Visit:**

- [sldl (slsk-batchdl) Repository](https://github.com/fiso64/slsk-batchdl)
- [fiso64's GitHub Profile](https://github.com/fiso64)
- [This Project's Repository](https://github.com/felixhj/sldl-gui-macos)

---

## Overview

sldl-gui for macOS is a Python application built with **PyObjC** (Cocoa) that simplifies the process of downloading music from Soulseek. It supports multiple input sources including YouTube playlist URLs, Spotify playlist URLs, wishlist files, and CSV files. The application extracts song information from these sources and uses the `sldl` command-line tool to download the corresponding tracks from Soulseek.

After the download process is complete, the application automatically finds the most recent `_index.csv` file generated by `sldl`, processes it to add human-readable state and error descriptions, saves the result to `log.csv`, and deletes the original `_index.csv` file.

## Features

### Multi-Source Support

- **YouTube Playlists**: Traditional playlist URL support
- **Spotify Playlists**: Spotify playlist URL support
- **Wishlist Files**: sldl wishlist file support with comprehensive management
- **CSV Files**: Arbitrary CSV file support with artist/title or track columns
- **Source Selection**: Dropdown to choose input source with dynamic UI
- **File Validation**: CSV format validation and error handling

### Download Management

- **Start/Stop Control**: Interrupt downloads at any time
- **Progress Tracking**: Real-time progress with status updates
- **Thread Safety**: Background threads with UI synchronization
- **Process Management**: Graceful termination with timeout/force kill
- **Concurrent Downloads**: Configurable concurrent download limit (1-4, default 2)
- **Progress Bar Enhancement**: Fixed progress tracking for all source types
- **Output Folder Naming**: Descriptive folder names for different sources

### Wishlist Management

- **Wishlist Input**: Use wishlist files as input source
- **Wishlist Mode**: Automatic tracking of failed downloads and removal of successful downloads
- **Failed Download Export**: Export failed downloads to wishlist format
- **File Operations**: Parse index files, generate wishlist files
- **Integration**: Full sldl wishlist functionality support
- **Wishlist UI**: Comprehensive wishlist management with View, Import, Export, and Clear functionality
- **Internal Wishlist**: Seamless background wishlist processing without file path requirements
- **CSV Export**: Export wishlist to CSV format with artist and title columns

### User Interface

- **Optimized Layout**: Compact design with source dropdown and URL field on same line
- **Directory Picker**: Enhanced file picker with "New Folder" creation capability
- **Concurrent Downloads UI**: Dropdown selection with proper validation and settings persistence
- **Wishlist Controls**: Streamlined button labels and scrollable popup interface
- **Thread-Safe Windows**: Proper window management and memory cleanup for popup dialogs
- **Enhanced Visual Design**: Improved spacing, alignment, and font consistency
- **Source Field Optimization**: Removed redundant labels, added placeholder text, optimized field positioning
- **Standardized Alignment**: Consistent field positioning using FIELD_START_X constant for perfect vertical alignment

### Menu-Based Tools

- **Extra Tools Menu**: CSV export and wishlist functionality
- **Bugs Menu**: Known bugs and bug reporting functionality
- **Acknowledgements Menu**: Credits and repository links
- **GitHub Integration**: Automatic fetching of guides and bug information

### Version Management

- **Automatic Checking**: Version check on startup via GitHub API
- **Update Notifications**: Native macOS alerts for updates
- **Background Processing**: Non-blocking version checks

### Settings Persistence

- **JSON-based Settings**: Automatically saves and restores user preferences
- **Multi-Source URLs**: Both URLs are saved independently, along with selected source
- **Quality Preferences**: Audio format and bitrate settings
- **Download Path**: Custom download directory selection
- **Listen Port**: Custom port configuration

## System Requirements

- **macOS**: 12.0 (Monterey) or later
- **Architecture**: Intel (x64) or Apple Silicon (arm64)
- **Python**: 3.9+ (bundled with application)

## Installation

To install sldl-gui for macOS on your macOS computer, open the Terminal application and run the following command. It will automatically detect your architecture and install the correct version of the application.

```bash
bash <(curl -sL https://raw.githubusercontent.com/felixhj/sldl-gui-macos/main/install.sh)
```

The application will be installed in `~/Applications/sldl-gui`.

The installer automatically detects your system architecture and macOS version, then downloads and installs the appropriate build. Since `sldl` is now bundled with the application, no additional dependencies need to be installed.

### Build Variants

The application is built for different macOS versions to ensure compatibility:

- **Monterey (macOS 12)**: For users on macOS 12.0 or later
- **Ventura (macOS 13)**: For users on macOS 13.0 or later
- **Sonoma (macOS 14)**: For users on macOS 14.0 or later

The installer automatically selects the appropriate version for your system.

> **Note**: Monterey builds are created locally since GitHub Actions no longer supports macOS 12 runners. See [BUILD_MONTEREY.md](BUILD_MONTEREY.md) for details on building Monterey versions locally.

### Running the Application

After the installation is complete, you can find the application in the folder mentioned above. You can run it in two ways:

1. **Finder**: Navigate to your Home folder, then to the `Applications` folder, then to `sldl-gui`, and double-click on `sldl-gui.app`.
2. **Terminal**:
   ```bash
   open ~/Applications/sldl-gui/sldl-gui.app
   ```

### Uninstalling the Application

If you need to remove sldl-gui from your system, you can use the included uninstall script:

1. **From DMG**: Double-click `uninstall.command` in the DMG file.
2. **From Terminal**: Run the uninstall script directly:
   ```bash
   ~/Applications/sldl-gui/uninstall.command
   ```

The uninstall script will:

- Remove the sldl-gui application from your system
- Delete all settings and preferences
- Remove any log files created by the application
- Clean up application cache and saved states
- Optionally restart the Dock to refresh any remaining references

## Usage

### Basic Workflow

1. **Launch the App**: Run the application using one of the methods above.
2. **Select Source**: Choose between "YouTube Playlist", "Spotify Playlist", "Wishlist", or "CSV File" from the dropdown menu.
3. **Enter Source Information**:
   - For YouTube/Spotify: Paste the playlist URL
   - For Wishlist: Browse to select a wishlist file
   - For CSV: Browse to select a CSV file (must have 'artist' and 'title' columns, or a 'track' column)
4. **Provide Credentials**: Enter your Soulseek username and password.
5. **Set Listen Port (Optional)**: If you experience port conflicts, specify a custom listening port.
6. **Set Download Path**: Select a directory for your downloads.
7. **Configure Audio Quality**:
   - **Preferred**: `sldl` will prioritize files matching these criteria but will accept other files if no match is found.
   - **Mandatory**: `sldl` will only download files that meet these exact criteria.
8. **Start Download**: Click the "Start Download" button.
9. **Monitor Progress**: Track the download status with accurate step counting in the main window.
10. **Control Downloads**: Use the "Stop Download" button to interrupt the process at any time if needed.
11. **Check the Log**: Once complete, a `log.csv` file will be created in the download directory with detailed results.

### Finding Your Soulseek Password

1. Open Soulseek
2. Click "Options" in the menu bar
3. Click "Disconnect"
4. Click "Login as..."
5. Your password will be visible in the password field

### Listen Port Configuration

I won't lie, I don't really understand this. My advice would be to just not touch this field if things are working.

My basic understanding is that if you have a modern router that has automatic port mapping (which they all should do) - as long as the port isn't being used by another application, the router will work out which one soulseek is using.

As such an appropriately high port number is selected, as this is less likely to interfere with other applications. You might want to refer to lists of common port mappings to check this - wikipedia has a list. Essentially everything below 49152 is registered, so you'd probably want to go above this. The max port number is 65535.

If you have an older router, you might need to set up port forwarding manually - you'll have to research this yourself.

Soulseek's port status checking website only works for manual port forwarding, so a failed test doesn't necessarily mean you're not reachable.

### Wishlist Features

When _wishlist mode_ is on, the following functions will occur:

- Failed or stopped downloads are automatically added to an internal wishlist which is saved between sessions
- Subsequent successfully downloaded tracks that are on the wishlist are removed from the wishlist (including when downloaded using sources other than 'Wishlist')

**Why is this useful?**
Some downloads will fail. Instead of keeping track of these manually and re-running searches, the GUI will do this for you.

**Other wishlist features:**

- You can select your wishlist from the sources, and this will be used for your search criteria
- 'View' shows current entries
- 'Export' saves this as a .csv
- 'Import' allows you to populate the internal wishlist from a .csv file
- 'Clear' clears the wishlist

You can manually edit your wishlist if you wish(list):
`~/.soulseek_downloader_wishlist.csv`

### Audio Format and Quality Controls

- **Preferred**: Prefers a certain format/bitrate, but will accept others if preferred not found
- **Mandatory**: Only accepts a certain format/bitrate

### Extra Tools

- 'Output to .csv' takes the currently selected spotify or youtube playlist and outputs this to a .csv file in the target directory

## Project Structure

```
sldl-gui-macos/
├── sldl-gui-macos.py         # Main PyObjC GUI application (2122 lines, 95KB)
├── csv_processor.py          # CSV processing module (218 lines, 8.2KB)
├── guides.txt                # Comprehensive user guides
├── bugs-to-fix.txt           # Known bugs documentation
├── build_monterey.sh         # Build script for Monterey
├── uninstall.command         # Uninstall script for users
├── install.sh                # Automated installer script
├── requirements.txt          # Python dependencies
├── entitlements.plist        # macOS entitlements for signing
├── icon.icns                 # Application icon
├── BUILD_MONTEREY.md         # Monterey build instructions
├── GITHUB_ACTIONS_UPDATE.md  # GitHub Actions workflow documentation
├── WISHLIST_USAGE.md         # Wishlist documentation
└── README.md                 # This documentation file
```

### Key Components

- **`sldl-gui-macos.py`**: The core application logic, GUI, download management, multi-source support, wishlist integration, version checking, comprehensive wishlist management system, concurrent downloads, optimized UI layout, enhanced directory picker
- **`csv_processor.py`**: A module that processes CSV log files to add human-readable descriptions
- **`guides.txt`**: Comprehensive user documentation covering all features and usage
- **`bugs-to-fix.txt`**: Known issues and bug tracking

## Technical Details

The application operates as follows:

1. It gathers user input from the GUI, including source selection and URL validation
2. It constructs and executes a command for the bundled `sldl` tool in a background thread
3. It captures and displays the real-time output from `sldl` in the GUI with accurate progress tracking
4. Users can stop the download at any time using the stop button, which gracefully terminates the process
5. After the `sldl` process finishes, it locates the most recent `_index.csv` in the download directory
6. It processes this file using the integrated CSV processor, which creates `log.csv` and deletes the source `_index.csv`

### CSV Processing

The `sldl` tool generates an `_index.csv` file with numeric codes for download status. The integrated CSV processor adds two new columns, `state_description` and `failure_description`, with human-readable text.

**State Codes:**

- **0**: `Initial`
- **1**: `Downloaded`
- **2**: `Failed`
- **3**: `AlreadyExists`
- **4**: `NotFoundLastTime`

**Failure Reason Codes:**

- **0**: `None`
- **1**: `InvalidSearchString`
- **2**: `OutOfDownloadRetries`
- **3**: `NoSuitableFileFound`
- **4**: `AllDownloadsFailed`
- **5**: `Other`

The final `log.csv` will contain these descriptive columns, providing a clear summary of the download session.

## Known Issues

- Status text when wishlist or CSV selected as source: 'Logging in' stays visible for too long, we can have a searching / other update before we get the first downloads
- No warning dialog when user quits if there is a download in progress
- Messy folder creation when using CSV or wishlist as sources

## Troubleshooting

### Port Conflicts

If you encounter "Failed to start listening" errors:

1. **Try a different port**: Use the "Listen Port" field to specify an alternative port (e.g., 2234, 50000, 60000).
2. **Check for other Soulseek clients**: Ensure no other Soulseek applications are running.
3. **Restart the application**: Sometimes a restart can resolve port conflicts.

### Authentication Failures

- **Double-check credentials**: Verify your Soulseek username and password.
- **Check Soulseek status**: Ensure the Soulseek network is accessible.

### Other Issues

- **CSV Processing Fails**: Ensure the download directory is writable, as the application needs to create `log.csv` and delete the original `_index.csv`.
- **Application won't start**: Check that you're running macOS 12.0 or later.
- **Stop button not working**: The stop button is only enabled during active downloads. If downloads appear stuck, try stopping and restarting the download process.
- **Source URL validation fails**: Ensure you've selected the correct source and that the URL/file is properly formatted.
- **Settings not persisting**: Check that the application has write permissions to your home directory for the settings file.

## Dependencies

### Python Dependencies

- `pyobjc-framework-Cocoa>=9.0` - Cocoa GUI framework
- `pyobjc-core>=9.0` - Core PyObjC functionality

### External Dependencies

- `sldl`: Command-line tool (bundled with application)
- macOS: 12.0+ with native Cocoa frameworks

## Key Design Decisions

1. **Native macOS Integration**: PyObjC over cross-platform frameworks
2. **Self-Contained Distribution**: Bundle sldl with application
3. **Thread-Safe Architecture**: Background threads with UI synchronization
4. **Settings Persistence**: JSON-based settings file
5. **Process Control**: Subprocess management with graceful termination
6. **Multi-Source Support**: Single app supporting multiple playlist sources
7. **Menu-Based Tools**: Extensible menu bar with additional functionality
8. **Development Environment**: Local setup with automatic binary download
9. **Version Management**: Automatic checking with GitHub API integration
10. **Wishlist Integration**: Full sldl wishlist functionality support
11. **Concurrent Downloads**: Configurable download parallelism for performance optimization
12. **Optimized UI**: Compact layout design for better user experience
13. **Enhanced File Operations**: Directory picker with folder creation capabilities

## License

This project is open source. See the LICENSE file for details.

## Disclaimer

This software is for personal and educational use only. Respect copyright laws and the terms of service of Soulseek and other platforms.

For more information about Soulseek, visit the official Soulseek website and documentation.
