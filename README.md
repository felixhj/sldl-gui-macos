# sldl-gui for macOS

A Python GUI application that provides a graphical user interface for batch downloading music from Soulseek using YouTube playlist URLs or Spotify playlist URLs.

## Overview

sldl-gui for macOS is a Python application built with **PyObjC** (Cocoa) that simplifies the process of downloading music from Soulseek. It takes YouTube playlist URLs or Spotify playlist URLs, extracts the song information, and uses the [slsk-batchdl](https://github.com/fiso64/slsk-batchdl) (`sldl`) command-line tool to download the corresponding tracks from Soulseek.

After the download process is complete, the application automatically finds the most recent `_index.csv` file generated by `sldl`, processes it to add human-readable state and error descriptions, saves the result to `log.csv`, and deletes the original `_index.csv` file.

## Features

- **Multi-Source Playlist Support**: Support for both YouTube and Spotify playlist URLs with source selection dropdown.
- **YouTube Playlist Integration**: Enter a YouTube playlist URL to automatically extract song information.
- **Spotify Playlist Integration**: Enter a Spotify playlist URL to automatically extract song information.
- **Soulseek Authentication**: Securely log in with your Soulseek username and password.
- **Custom Download Path**: Specify where you want to save your downloaded music.
- **Listen Port Configuration**: Set a custom listening port to avoid conflicts with other Soulseek clients.
- **Real-time Progress Tracking**: View download progress with accurate step counting and status updates.
- **Download Control**: Stop ongoing downloads at any time with the integrated stop button.
- **Automated CSV Processing**: Automatically processes the `_index.csv` file post-download:
  - Converts numeric status codes to human-readable descriptions.
  - Saves the cleaned data to `log.csv`.
  - Deletes the original `_index.csv` file.
- **Settings Persistence**: Automatically saves and restores user preferences (credentials, paths, quality settings, listen port, playlist URLs, and source selection).
- **Quality Control**: Set preferred and strict requirements for audio format and bitrate.
- **Modern UI**: Clean, intuitive interface built with native Cocoa and PyObjC.
- **Thread-Safe Operations**: Downloads run in a background thread to keep the GUI responsive.
- **Self-Contained**: Includes the `sldl` dependency bundled with the application.

## System Requirements

- **macOS**: 12.0 (Monterey) or later
- **Architecture**: Intel (x64) or Apple Silicon (arm64)

## Prerequisites

sldl-gui for macOS now includes the `sldl` command-line tool bundled with the application, so no separate installation is required. The application automatically downloads and bundles the latest version of `sldl` during the build process.

## Installation

To install sldl-gui for macOS on your macOS computer, open the Terminal application and run the following command. It will automatically detect your architecture and install the correct version of the application.

```bash
bash <(curl -sL https://raw.githubusercontent.com/felixhj/sldl-gui-macos/main/install.sh)
```

The application will be installed in `~/Applications/sldl-gui`.

The installer automatically detects your system architecture and macOS version, then downloads and installs the appropriate build. Since `sldl` is now bundled with the application, no additional dependencies need to be installed.

### Build Variants

The application is built for different macOS versions to ensure compatibility:

- **Monterey (macOS 12)**: For users on macOS 12.0 or later
- **Ventura (macOS 13)**: For users on macOS 13.0 or later
- **Sonoma (macOS 14)**: For users on macOS 14.0 or later

The installer automatically selects the appropriate version for your system.

> **Note**: Monterey builds are created locally since GitHub Actions no longer supports macOS 12 runners. See [BUILD_MONTEREY.md](BUILD_MONTEREY.md) for details on building Monterey versions locally.

### Running the Application

After the installation is complete, you can find the application in the folder mentioned above. You can run it in two ways:

1.  **Finder**: Navigate to your Home folder, then to the `Applications` folder, then to `sldl-gui`, and double-click on `sldl-gui.app`.
2.  **Terminal**:
    ```bash
    open ~/Applications/sldl-gui/sldl-gui.app
    ```

### Uninstalling the Application

If you need to remove sldl-gui from your system, you can use the included uninstall script:

1.  **From DMG**: Double-click `uninstall.command` in the DMG file.
2.  **From Terminal**: Run the uninstall script directly:
    ```bash
    ~/Applications/sldl-gui/uninstall.command
    ```

The uninstall script will:

- Remove the sldl-gui application from your system
- Delete all settings and preferences
- Remove any log files created by the application
- Clean up application cache and saved states
- Optionally restart the Dock to refresh any remaining references

## Usage

1.  **Launch the App**: Run the application using one of the methods above.
2.  **Select Playlist Source**: Choose between "YouTube Playlist" or "Spotify Playlist" from the dropdown menu.
3.  **Enter Playlist URL**: Paste the URL of a public or unlisted YouTube playlist or Spotify playlist based on your selection.
4.  **Provide Credentials**: Enter your Soulseek username and password. You can choose to have the password remembered for future sessions (stored unencrypted in a local settings file).
5.  **Set Listen Port (Optional)**: If you experience port conflicts with other Soulseek clients, specify a custom listening port. Leave empty to use the default (49998).
6.  **Set Download Path**: Select a directory for your downloads. If left empty, files will be saved in the default location used by `sldl`.
7.  **Configure Audio Quality**:
    - **Preferred**: `sldl` will prioritize files matching these criteria but will accept other files if no match is found.
    - **Strict**: `sldl` will only download files that meet these exact criteria.
8.  **Start Download**: Click the "Start Download" button.
9.  **Monitor Progress**: Track the download status with accurate step counting in the main window.
10. **Control Downloads**: Use the "Stop Download" button to interrupt the process at any time if needed.
11. **Check the Log**: Once complete, a `log.csv` file will be created in the download directory with detailed results. The original `_index.csv` is removed automatically.

### Multi-Source Playlist Support

The application supports both YouTube and Spotify playlists:

- **YouTube Playlists**: Traditional support for YouTube playlist URLs (youtube.com or youtu.be)
- **Spotify Playlists**: Support for Spotify playlist URLs (spotify.com or open.spotify.com)
- **Source Selection**: Use the dropdown to switch between YouTube and Spotify
- **URL Validation**: Basic validation ensures the correct URL format for each source
- **Settings Persistence**: Both URLs are saved independently, along with your selected source

### Listen Port Configuration

If you encounter port conflicts (e.g., "Failed to start listening on 0.0.0.0:49998"), you can specify a custom listening port:

- **Default Port**: 49998 (used if no custom port is specified)
- **Recommended Range**: 1024-65535 (avoid ports already in use by other applications)
- **Common Alternatives**: 2234-2242 (traditional Soulseek range), 50000+ (high range to avoid conflicts)

The application will remember your preferred port for future sessions.

### Using the CSV Processor Standalone

The CSV processor functionality is now integrated into the main application, but you can still run it independently if needed:

```bash
# Process a single CSV file
python3 csv_processor.py /path/to/_index.csv

# The script will create log.csv in the same directory and delete _index.csv
```

## Settings Persistence

The application saves your settings to `~/.soulseek_downloader_settings.json`. The following are stored:

- Soulseek username and password (password is only saved if "Remember Password" is checked).
- Download path.
- Listen port preference.
- Audio quality preferences.
- Playlist URLs (both YouTube and Spotify URLs are saved independently).
- Selected playlist source (YouTube or Spotify).

**Security Note**: The password is saved in plain text. Only use the "Remember Password" feature on a secure, personal computer.

## Project Structure

```
sldl-gui-macos/
├── sldl-gui-macos.py         # Main PyObjC GUI application with download control
├── csv_processor.py          # CSV processing module (integrated)
├── build_monterey.sh         # Build script for Monterey
├── uninstall.command         # Uninstall script for users
├── install.sh                # Automated installer script
├── requirements.txt          # Python dependencies
├── entitlements.plist        # macOS entitlements for signing
├── icon.icns                 # Application icon
├── BUILD_MONTEREY.md         # Monterey build instructions
├── GITHUB_ACTIONS_UPDATE.md  # GitHub Actions workflow documentation
└── README.md                 # This documentation file
```

### Key Components

- **`sldl-gui-macos.py`**: The core application logic, GUI, download management, download control (stop button functionality), and multi-source playlist support (YouTube and Spotify).
- **`csv_processor.py`**: A module that processes CSV log files to add human-readable descriptions.
- **`build_monterey.sh`**: Automated build script that downloads dependencies and creates the application bundle.
- **`install.sh`**: Automated installer script that detects system architecture and macOS version.

## Technical Details

The application operates as follows:

1.  It gathers user input from the GUI, including playlist source selection and URL validation.
2.  It constructs and executes a command for the bundled `sldl` tool in a background thread.
3.  It captures and displays the real-time output from `sldl` in the GUI with accurate progress tracking.
4.  **Download Control**: Users can stop the download at any time using the stop button, which gracefully terminates the process.
5.  After the `sldl` process finishes, it locates the most recent `_index.csv` in the download directory.
6.  It processes this file using the integrated CSV processor, which creates `log.csv` and deletes the source `_index.csv`.

### CSV Processing

The `sldl` tool generates an `_index.csv` file with numeric codes for download status. The integrated CSV processor adds two new columns, `state_description` and `failure_description`, with human-readable text.

**State Codes:**

- **0**: `Initial`
- **1**: `Downloaded`
- **2**: `Failed`
- **3**: `AlreadyExists`
- **4**: `NotFoundLastTime`

**Failure Reason Codes:**

- **0**: `None`
- **1**: `InvalidSearchString`
- **2**: `OutOfDownloadRetries`
- **3**: `NoSuitableFileFound`
- **4**: `AllDownloadsFailed`
- **5**: `Other`

The final `log.csv` will contain these descriptive columns, providing a clear summary of the download session.

## Troubleshooting

### Port Conflicts

If you encounter "Failed to start listening" errors:

1. **Try a different port**: Use the "Listen Port" field to specify an alternative port (e.g., 2234, 50000, 60000).
2. **Check for other Soulseek clients**: Ensure no other Soulseek applications are running.
3. **Restart the application**: Sometimes a restart can resolve port conflicts.

### Authentication Failures

- **Double-check credentials**: Verify your Soulseek username and password.
- **Check Soulseek status**: Ensure the Soulseek network is accessible.

### Other Issues

- **CSV Processing Fails**: Ensure the download directory is writable, as the application needs to create `log.csv` and delete the original `_index.csv`.
- **Application won't start**: Check that you're running macOS 12.0 or later.
- **Stop button not working**: The stop button is only enabled during active downloads. If downloads appear stuck, try stopping and restarting the download process.
- **Playlist URL validation fails**: Ensure you've selected the correct source (YouTube or Spotify) and that the URL is properly formatted for the selected platform.
- **Settings not persisting**: Check that the application has write permissions to your home directory for the settings file.

## Requirements

- **Python**: 3.9+
- **OS**: macOS 12.0 (Monterey) or later
- **Dependencies**: `pyobjc-framework-Cocoa` (automatically handled by build script)
- **`sldl`**: Automatically bundled with the application

## Application Evolution

This application has evolved from the original "Soulseek Downloader" to "sldl-gui" with the following key improvements:

- **Multi-Source Support**: Added Spotify playlist support alongside YouTube playlists
- **Download Control**: Implemented stop button functionality for interrupting downloads
- **Enhanced UI**: Improved interface with source selection and dynamic URL fields
- **Better Settings Management**: Enhanced settings persistence for multiple playlist sources
- **Thread-Safe Operations**: Improved background processing with proper UI synchronization
- **Self-Contained Distribution**: Bundled `sldl` dependency for easier installation

## License

This project is open source. See the LICENSE file for details.

## Disclaimer

This software is for personal and educational use only. Respect copyright laws and the terms of service of Soulseek and YouTube.

## Acknowledgments

- This project is a GUI wrapper for the powerful [slsk-batchdl](https://github.com/fiso64/slsk-batchdl) by [fiso64](https://github.com/fiso64).
- Built with Python and PyObjC.
